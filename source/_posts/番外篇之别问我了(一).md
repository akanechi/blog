---
title: 番外篇之《如何发布并使用地图服务》
---

鉴于《WebGIS原理与应用》(资环地信大三上选修)在学习通发布 (2020年11月24日) 的PBL任务，在此做一个简单的教程，去教大家如何使用自己的地图服务(已经演示了ArcGIS Server的安装和发布地图服务的教程，网上也有很多详细的教程)。本人使用的是**ArcGIS Server 10.2**和**ArcGIS API for JavaScript**（也可以使用openlayer，原理一样）。

## 1. 发布地图服务

[ArcGIS Server 10.2安装及破解教程](https://blog.csdn.net/m0_37768631/article/details/89207346)

[ArcGIS Server发布地图服务](https://jingyan.baidu.com/article/fdbd4277bd5810b89e3f48d7.html)

这里主要叙述如何使用自己的地图服务。

## 2. 使用已发布的地图服务

#### 2.1 添加esri提供的css和js

```JavaScript
    /*
    * 在head标签中引用css和js，这里的引用是官方提供，需要网络
    * 若需要本地引用
    * <link rel="stylesheet" href="http://localhost/arcgis_js_api/library/4.17/esri/themes/light/main.css">
    * <script src="http://localhost/arcgis_js_api/library/4.17/init.js"></script>
    */

	<link rel="stylesheet" href="https://js.arcgis.com/4.17/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.17/"></script>
```

#### 2.2 定义地图挂载的DOM节点

定义挂载地图DOM节点

```html
    //在body中定义一个div
    <div id="viewDiv"></div>
```

在head中定义容器的大小

```html
    <style>
        /*默认空的div是没有大小的，不定义容器的大小，即使地图填充了这个div也不会  
        * 改变div的大小，所以要先定义。
        */
        body, html, #viewDiv {
            width: 100%;
            height: 100%;
            margin: 0;
        }
    </style>
```

#### 2.3 定义地图容器

```html
    //在body中
    <script>
        require([
            "esri/Map", //调用Map，这个存放地图的容器
            "esri/views/MapView", //调用MapView，这个用来声明我们的地图显示在哪里
            "esri/layers/FeatureLayer" //调用FeatureLayer，用它来引用我们的地图服务
        ], function(Map, MapView, FeatureLayer) {

            //定义一个名为map的地图容器
            var map = new Map({
                basemap: "satellite", //选择一张底图
                center: [109, 40] //定义地图中心
                zoom: 5 //定义地图缩放等级
            });
        });
    </script>
```

#### 2.4 获取地图服务url

在ArcGIS Server Manager中打开之前发布的地图服务，这里用见习小组成果为例子。

复制红色框框选的内容

例：http://localhost:6080/arcgis/rest/services//BaotouCity/jiuyuanBlock/MapServer

![WMS](../../public/assets/WMS.png "jiuyuan block")

#### 2.5 使用地图服务

回到代码

```html
    //在head或body中(script代码放在head和body中都可以，但是css不行)
    <script>
        require([
            "esri/Map", //调用Map，这个存放地图的容器
            "esri/views/MapView", //调用MapView，这个用来声明我们的地图显示在哪里
            "esri/layers/FeatureLayer" //调用FeatureLayer，用它来引用我们的地图服务
        ], function(Map, MapView, FeatureLayer) {

            //定义一个名为map的地图容器
            var map = new Map({
                basemap: "satellite", //选择一张底图
            });

            //使用地图服务
            var jiuyuanBlock = new FeatureLayer({
                //url中放你刚才复制的地址
                url: "http://localhost:6080/arcgis/rest/services//BaotouCity/jiuyuanBlock/MapServer"
            });
            //将图层添加到地图中
            map.add(jiuyuanBlock);

            var view = new MapView({
                container: "viewDiv", //选择挂载的DOM节点
                map: map, //选择地图，就选择刚才定义的map
                center: [109.9, 40.6] //定义地图中心
                zoom: 12 //定义地图缩放等级
            });
        });
    </script>
```

#### 2.6 完整代码

详细请参考[ArcGIS API for JavaScript官方文档](https://developers.arcgis.com/javascript/)

本次所需要学习的东西：  
创建基本的地图：[Create a starter app](https://developers.arcgis.com/javascript/latest/guide/create-a-starter-app/)  
添加图层到地图：[Add layers to a map](https://developers.arcgis.com/javascript/latest/guide/add-layers-to-a-map/)

完整代码：
```html
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewpot" content="initial-scale=1,maximum-scale=1,user-scalable=no">
        <title>WMS</title>

        <link rel="stylesheet" href="https://js.arcgis.com/4.17/esri/themes/light/main.css">
        <script src="https://js.arcgis.com/4.17/"></script>

        <style type="text/css">
            html, body, #viewDiv{
                padding: 0;
                margin: 0;
                width: 100%;
                height: 100%;
            }
        </style>
        <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/FeatureLayer"
        ], function (Map, MapView, FeatureLayer) {
            //定义地图容器
            var map = new Map({
                    basemap: "satellite", //选择一张底图
                });

                //创建一个要素图层
                var jiuyuanBlock = new FeatureLayer({
                    //使用发布的地图服务
                    url: "http://localhost:6080/arcgis/rest/services//BaotouCity/jiuyuanBlock/MapServer" //你刚才复制的地址
                });
                //将图层添加到地图中
                map.add(jiuyuanBlock);

                //创建一个地图视图来显示你的地图
                var view = new MapView({
                    container: "viewDiv", //选择挂载的DOM节点
                    map: map, //选择地图，就选择刚才定义的map
                    center: [109.9, 40.6], //定义地图中心
                    zoom: 12 //定义地图缩放等级
                });
        });
        </script>
    </head>

    <body>
        <div id="viewDiv"></div>
    </body>

    </html>
```

## 3. 结束

到这里，加载个人地图服务教程基本到此结束。对于老师的要求，在此之上添加其他内容就需要复习并使用之前的知识(HTML, CSS, JavaScript)。将代码展示出来希望大家不要复制粘贴(当然你铁了心要CV，那我也没办法)，希望大家能都自己手动输入一遍，加深印象。

如果有其他问题，我会在我能力范围之内帮助大家解决。

若有错误，望指出！

                                                                作者：Yangguang Guo